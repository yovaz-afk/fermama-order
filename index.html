<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–§–µ—Ä–ú–∞–º–∞ ‚Äî –ó–∞—è–≤–∫–∏</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    body { font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    input[type="number"] { -moz-appearance: textfield; }
  </style>
</head>

<body class="bg-slate-50">
  <div class="min-h-screen flex items-start justify-center p-4">
    <div class="w-full max-w-3xl">
      <div class="bg-white rounded-2xl shadow-sm border border-slate-100 p-5 sm:p-6">
        <div class="flex items-center gap-3 mb-5">
          <div class="w-10 h-10 rounded-xl bg-emerald-600 flex items-center justify-center">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" class="text-white">
              <path d="M7 7h10v10H7V7Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
              <path d="M7 12h10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <path d="M12 7v10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </div>
          <div>
            <h1 class="text-xl sm:text-2xl font-bold text-slate-900">–§–µ—Ä–ú–∞–º–∞ ‚Äî –ó–∞—è–≤–∫–∞</h1>
            <p class="text-slate-500 text-sm">–ü—Ä–∏—ë–º –∑–∞—è–≤–æ–∫ —Ç–æ—Ä–≥–æ–≤—ã–º–∏ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª—è–º–∏</p>
          </div>
        </div>

        <!-- –í–µ—Ä—Ö–Ω—è—è —Ñ–æ—Ä–º–∞ -->
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
          <div>
            <label class="text-xs font-semibold text-slate-600">–ú–ï–ù–ï–î–ñ–ï–†</label>
            <select id="manager" class="mt-1 w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-slate-900 focus:outline-none focus:ring-2 focus:ring-emerald-200">
            </select>
          </div>

          <div>
            <label class="text-xs font-semibold text-slate-600">–ö–õ–ò–ï–ù–¢</label>
            <select id="client" class="mt-1 w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-slate-900 focus:outline-none focus:ring-2 focus:ring-emerald-200">
            </select>
          </div>

          <div>
            <label class="text-xs font-semibold text-slate-600">–î–ê–¢–ê –ü–†–ò–Å–ú–ê</label>
            <input id="date" type="date" class="mt-1 w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-slate-900 focus:outline-none focus:ring-2 focus:ring-emerald-200"/>
          </div>
        </div>

        <!-- –°–æ—Å—Ç–∞–≤ –∑–∞—è–≤–∫–∏ -->
        <div class="mt-6 flex items-center justify-between">
          <h2 class="text-slate-900 font-bold">–°–æ—Å—Ç–∞–≤ –∑–∞—è–≤–∫–∏</h2>
          <span id="itemsCount" class="text-xs font-semibold px-2 py-1 rounded-full bg-emerald-50 text-emerald-700">0 –ø–æ–∑.</span>
        </div>

        <div id="items" class="mt-3 space-y-3"></div>

        <button id="addItemBtn" class="mt-3 w-full rounded-xl border border-slate-200 bg-white px-4 py-3 font-semibold text-slate-800 hover:bg-slate-50 active:bg-slate-100 transition">
          + –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä
        </button>

        <!-- –ò—Ç–æ–≥ -->
        <div class="mt-6 flex items-center justify-between bg-slate-50 border border-slate-100 rounded-2xl p-4">
          <div class="text-slate-600 text-sm font-semibold">–ò–¢–û–ì–û –ö –û–ü–õ–ê–¢–ï</div>
          <div id="total" class="text-slate-900 text-2xl font-bold">0 ‚ÇΩ</div>
        </div>

        <div class="mt-4 grid grid-cols-1 sm:grid-cols-3 gap-3">
          <button id="copyBtn" class="rounded-xl border border-slate-200 bg-white px-4 py-3 font-semibold text-slate-800 hover:bg-slate-50 active:bg-slate-100 transition">
            –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç
          </button>

          <button id="telegramBtn" class="sm:col-span-2 rounded-xl bg-emerald-600 px-4 py-3 font-semibold text-white hover:bg-emerald-700 active:bg-emerald-800 transition flex items-center justify-center gap-2">
            –í Telegram
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
              <path d="M22 2L11 13" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M22 2L15 22L11 13L2 9L22 2Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>

        <p class="mt-3 text-xs text-slate-500">
          –û—Ç–ø—Ä–∞–≤–∫–∞ –∏–¥—ë—Ç —á–µ—Ä–µ–∑ Telegram Share (–±–µ–∑ –±–æ—Ç–∞). –ï—Å–ª–∏ Telegram –Ω–µ –æ—Ç–∫—Ä—ã–ª—Å—è ‚Äî –Ω–∞–∂–º–∏ ‚Äú–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç‚Äù –∏ –≤—Å—Ç–∞–≤—å –≤—Ä—É—á–Ω—É—é.
        </p>
      </div>
    </div>
  </div>

<script>
(function(){
  // ===== –î–ê–ù–ù–´–ï =====

  const managers = [
    {
      id: "natalya",
      name: "–ù–∞—Ç–∞–ª—å—è –ô–æ—à–∫–∞—Ä-–û–ª–∞",
      clients: [
        "–ò–ü –ö–∞–ª–∏–Ω–∏–Ω–∞ –ï–ª–µ–Ω–∞ –°–µ—Ä–≥–µ–µ–≤–Ω–∞",
        "–ò–ü –ö–∞—é–º–æ–≤ –†—É—Å—Ç–∞–º –ú–∞–Ω—Å—É—Ä–æ–≤–∏—á",
        "–ò–ü –ë—É—Ä–ª—É—Ü–∫–∞—è –û.–°.",
        "–û–û–û \"–õ–∏–Ω–∞\"",
        "–û–û–û \"–ë–∏–∑–Ω–µ—Å–ü—Ä–æ–µ–∫—Ç\"",
        "–ò–ü –ë–£–†–õ–£–¶–ö–ò–ô –ï–í–ì–ï–ù–ò–ô –í–ò–ö–¢–û–†–û–í–ò–ß"
      ]
    },
    {
      id: "maria",
      name: "–ú–∞—Ä–∏—è –ß–µ–±–æ–∫—Å–∞—Ä—ã",
      clients: [
        "–ê–≥—Ä–æ—Ñ–∏—Ä–º–∞",
        "–ê—Ç–ª–∞—à–µ–≤–æ –ò–≤–∞–Ω–æ–≤–∞ –û–∫—Å–∞–Ω–∞ –í–∏–∫—Ç–æ—Ä–æ–≤–Ω–∞",
        "–ù–æ–≤–æ—á–µ–±–æ–∫—Å–∞—Ä–∫ 5",
        "–í—É—Ä–º–∞–Ω–∫–∞—Å—ã –ò–≤–∞–Ω–æ–≤–∞ –õ.–Æ.",
        "–ù–æ–≤. –≥–æ—Ä–æ–¥",
        "–ù–æ–≤–æ—á–µ–±–æ–∫—Å—Ä–∞—Å–∫"
      ]
    }
  ];

  // product: { id, name, unit: "—à—Ç"|"–∫–≥", price }
  const products = [
    // –®–¢–£–ß–ù–´–ï (—à—Ç)
    { id:"p1",  name:"–í–∞—Ä–µ–Ω–∏–∫–∏ —Å –∫–∞—Ä—Ç–æ—à–∫–æ–π 450 –≥—Ä –§–µ—Ä–ú–∞–º–∞", unit:"—à—Ç", price:145 },
    { id:"p2",  name:"–í–∞—Ä–µ–Ω–∏–∫–∏ —Å –∫–∞—Ä—Ç–æ—à–∫–æ–π 900 –≥—Ä –§–µ—Ä–ú–∞–º–∞", unit:"—à—Ç", price:290 },
    { id:"p3",  name:"–ì–æ–ª—É–±—Ü—ã –ª–µ–Ω–∏–≤—ã–µ 500–≥ –§–µ—Ä–º–∞–º–∞", unit:"—à—Ç", price:220 },
    { id:"p5",  name:"–ó—Ä–∞–∑—ã –õ—é–±–∏—Ç–µ–ª—å—Å–∫–∏–µ 500 –≥—Ä –§–µ—Ä–ú–∞–º–∞", unit:"—à—Ç", price:225 },
    { id:"p8",  name:"–ö–æ—Ç–ª–µ—Ç—ã –î–æ–º–∞—à–Ω–∏–µ 500 –≥—Ä –§–µ—Ä–ú–∞–º–∞", unit:"—à—Ç", price:265 },
    { id:"p9",  name:"–ö–æ—Ç–ª–µ—Ç—ã –ü–æ-–∫–∏–µ–≤—Å–∫–∏ 500 –≥—Ä –§–µ—Ä–ú–∞–º–∞", unit:"—à—Ç", price:240 },
    { id:"p10", name:"–ö–æ—Ç–ª–µ—Ç—ã –ü–æ–∂–∞—Ä—Å–∫–∏–µ 500 –≥—Ä –§–µ—Ä–ú–∞–º–∞", unit:"—à—Ç", price:230 },
    { id:"p11", name:"–ö–æ—Ç–ª–µ—Ç—ã –§–∏—Ä–º–µ–Ω–Ω—ã–µ 500 –≥—Ä –§–µ—Ä–ú–∞–º–∞", unit:"—à—Ç", price:268 },
    { id:"p12", name:"–ö–æ—Ç–ª–µ—Ç—ã –∏–∑ –∏–Ω–¥–µ–π–∫–∏ 500 –≥ –§–µ—Ä–ú–∞–º–∞", unit:"—à—Ç", price:300 },
    { id:"p13", name:"–ö–æ—Ç–ª–µ—Ç—ã –∫—É—Ä–∏–Ω—ã–µ —Å —Å—ã—Ä–Ω–æ-—Å–ª–∏–≤–æ—á–Ω–æ–π –Ω–∞—á–∏–Ω–∫–æ–π 500 –≥—Ä –§–µ—Ä–ú–∞–º–∞", unit:"—à—Ç", price:258 },
    { id:"p14", name:"–ú–∞–Ω—Ç—ã –ø–æ-—Å–∏–±–∏—Ä—Å–∫–∏ 450 –≥—Ä –§–µ—Ä–ú–∞–º–∞", unit:"—à—Ç", price:185 },
    { id:"p15", name:"–ú–∞–Ω—Ç—ã –ø–æ-—Å–∏–±–∏—Ä—Å–∫–∏ 900 –≥—Ä –§–µ—Ä–ú–∞–º–∞", unit:"—à—Ç", price:370 },
    { id:"p16", name:"–ù–∞–≥–≥–µ—Ç—Å—ã –§–∏—Ä–º–µ–Ω–Ω—ã–µ 500 –≥—Ä –§–µ—Ä–ú–∞–º–∞", unit:"—à—Ç", price:255 },
    { id:"p17", name:"–ü–µ–ª—å–º–µ–Ω–∏ –î–æ–º–∞—à–Ω–∏–µ 450 –≥—Ä –§–µ—Ä–ú–∞–º–∞", unit:"—à—Ç", price:179 },
    { id:"p18", name:"–ü–µ–ª—å–º–µ–Ω–∏ –î–æ–º–∞—à–Ω–∏–µ 900 –≥—Ä –§–µ—Ä–ú–∞–º–∞", unit:"—à—Ç", price:358 },
    { id:"p19", name:"–ü–µ–ª—å–º–µ–Ω–∏ –ö—É—Ä–∏–Ω—ã–µ 450 –≥—Ä –§–µ—Ä–ú–∞–º–∞", unit:"—à—Ç", price:159 },
    { id:"p20", name:"–ü–µ–ª—å–º–µ–Ω–∏ –ö—É—Ä–∏–Ω—ã–µ 900 –≥—Ä –§–µ—Ä–ú–∞–º–∞", unit:"—à—Ç", price:318 },
    { id:"p21", name:"–ü–µ–ª—å–º–µ–Ω–∏ –°–≤–∏–Ω–∏–Ω–∞-–ö—É—Ä–∏—Ü–∞ 450 –≥—Ä –§–µ—Ä–ú–∞–º–∞", unit:"—à—Ç", price:160 },
    { id:"p22", name:"–ü–µ–ª—å–º–µ–Ω–∏ –°–≤–∏–Ω–∏–Ω–∞-–ö—É—Ä–∏—Ü–∞ 900 –≥—Ä –§–µ—Ä–ú–∞–º–∞", unit:"—à—Ç", price:320 },
    { id:"p23", name:"–ü–µ–ª—å–º–µ–Ω–∏ –∏–∑ —Å–≤–∏–Ω–∏–Ω—ã 450–≥ –§–µ—Ä–ú–∞–º–∞", unit:"—à—Ç", price:161 },
    { id:"p24", name:"–ü–µ–ª—å–º–µ–Ω–∏ –∏–∑ —Å–≤–∏–Ω–∏–Ω—ã 900–≥ –§–µ—Ä–ú–∞–º–∞", unit:"—à—Ç", price:322 },
    { id:"p25", name:"–ü–µ–ª—å–º–µ–Ω–∏ –∏–∑ —Ñ–∏–ª–µ –≥—Ä—É–¥–∫–∏ –∏–Ω–¥–µ–π–∫–∏ —Å–æ —Å–ª–∏–≤. –º–∞—Å–ª–æ–º 450 –≥—Ä –§–µ—Ä–ú–∞–º–∞", unit:"—à—Ç", price:185 },
    { id:"p26", name:"–ü–µ–ª—å–º–µ–Ω–∏ –∏–∑ —Ñ–∏–ª–µ –≥—Ä—É–¥–∫–∏ –∏–Ω–¥–µ–π–∫–∏ —Å–æ —Å–ª–∏–≤. –º–∞—Å–ª–æ–º 900 –≥—Ä –§–µ—Ä–ú–∞–º–∞", unit:"—à—Ç", price:370 },
    { id:"p27", name:"–ü–æ–¥–∫–æ–≥–æ–ª–∏ –î–æ–º–∞—à–Ω–∏–µ 450 –≥—Ä –§–µ—Ä–ú–∞–º–∞", unit:"—à—Ç", price:175 },
    { id:"p28", name:"–ü–æ–¥–∫–æ–≥–æ–ª–∏ –î–æ–º–∞—à–Ω–∏–µ 900 –≥—Ä –§–µ—Ä–ú–∞–º–∞", unit:"—à—Ç", price:350 },
    { id:"p29", name:"–†–∞–≤–∏–æ–ª–∏ 450–≥ –§–µ—Ä–ú–∞–º–∞", unit:"—à—Ç", price:263 },
    { id:"p30", name:"–†–∞–≤–∏–æ–ª–∏ 900–≥ –§–µ—Ä–ú–∞–º–∞", unit:"—à—Ç", price:525 },
    { id:"p31", name:"–§—Ä–∏–∫–∞–¥–µ–ª—å–∫–∏ –õ—é–±–∏–º—ã–µ 500 –≥—Ä –§–µ—Ä–ú–∞–º–∞", unit:"—à—Ç", price:199 },
    { id:"p32", name:"–ß–µ–±—É—Ä–µ–∫–∏ –ø–æ-–¥–æ–º–∞—à–Ω–µ–º—É 500 –≥—Ä –§–µ—Ä–ú–∞–º–∞", unit:"—à—Ç", price:229 },
    { id:"p33", name:"–ß–µ–±—É—Ä–µ–∫–∏ —Å –∫—É—Ä–∏—Ü–µ–π 500 –≥—Ä –§–µ—Ä–ú–∞–º–∞", unit:"—à—Ç", price:190 },
    { id:"p34", name:"–ß–µ–±—É—Ä–µ–∫–∏ —Å —Å—ã—Ä–æ–º 500 –≥—Ä –§–µ—Ä–ú–∞–º–∞", unit:"—à—Ç", price:279 },
    { id:"p35", name:"–°—ã—Ä–Ω–∏–∫–∏ 500 –≥—Ä –§–µ—Ä–ú–∞–º–∞", unit:"—à—Ç", price:270 },

    // –í–ï–°–û–í–´–ï –ò–ó–ù–ê–ß–ê–õ–¨–ù–û (–∫–≥)
    { id:"p4",  name:"–ì–æ–ª—É–±—Ü—ã —Å –º—è—Å–æ–º –∏ —Ä–∏—Å–æ–º –≤–µ—Å.", unit:"–∫–≥", price:339 },
    { id:"p6",  name:"–ö–æ–ª–±–∞—Å–∫–∏ –ì—Ä–∏–ª—å —Å —Å—ã—Ä–æ–º –≤–µ—Å.", unit:"–∫–≥", price:450 },
    { id:"p7",  name:"–ö–æ–ª–±–∞—Å–∫–∏ –∫—É—Ä–∏–Ω—ã–µ –∏–∑ —Ñ–∏–ª–µ –≥—Ä—É–¥–∫–∏ –≤–µ—Å.", unit:"–∫–≥", price:416 },
    { id:"p36", name:"–§–∞—Ä—à –°–≤–∏–Ω–∏–Ω–∞-–≥–æ–≤—è–¥–∏–Ω–∞ –≤–µ—Å.", unit:"–∫–≥", price:499 },
    { id:"p37", name:"–§–∞—Ä—à –°–≤–∏–Ω–æ–π –≤–µ—Å.", unit:"–∫–≥", price:395 },

    // –î–û–ë–ê–í–õ–ï–ù–ù–´–ï –í–ï–°–û–í–´–ï (–∫–≥) ‚Äî —Ä–∞—Å—á—ë—Ç –ø–æ —Ç–≤–æ–µ–º—É –ø—Ä–∞–≤–∏–ª—É, –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ –¥–æ —Ü–µ–ª–æ–≥–æ
    { id:"w1",  name:"–í–∞—Ä–µ–Ω–∏–∫–∏ —Å –∫–∞—Ä—Ç–æ—à–∫–æ–π –≤–µ—Å.", unit:"–∫–≥", price:322 },
    { id:"w2",  name:"–ì–æ–ª—É–±—Ü—ã –ª–µ–Ω–∏–≤—ã–µ –≤–µ—Å.", unit:"–∫–≥", price:440 },
    { id:"w3",  name:"–ó—Ä–∞–∑—ã –õ—é–±–∏—Ç–µ–ª—å—Å–∫–∏–µ –≤–µ—Å.", unit:"–∫–≥", price:450 },
    { id:"w4",  name:"–ö–æ—Ç–ª–µ—Ç—ã –î–æ–º–∞—à–Ω–∏–µ –≤–µ—Å.", unit:"–∫–≥", price:530 },
    { id:"w5",  name:"–ö–æ—Ç–ª–µ—Ç—ã –ü–æ-–∫–∏–µ–≤—Å–∫–∏ –≤–µ—Å.", unit:"–∫–≥", price:480 },
    { id:"w6",  name:"–ö–æ—Ç–ª–µ—Ç—ã –ü–æ–∂–∞—Ä—Å–∫–∏–µ –≤–µ—Å.", unit:"–∫–≥", price:460 },
    { id:"w7",  name:"–ö–æ—Ç–ª–µ—Ç—ã –§–∏—Ä–º–µ–Ω–Ω—ã–µ –≤–µ—Å.", unit:"–∫–≥", price:536 },
    { id:"w8",  name:"–ö–æ—Ç–ª–µ—Ç—ã –∏–∑ –∏–Ω–¥–µ–π–∫–∏ –≤–µ—Å.", unit:"–∫–≥", price:600 },
    { id:"w9",  name:"–ö–æ—Ç–ª–µ—Ç—ã –∫—É—Ä–∏–Ω—ã–µ —Å —Å—ã—Ä–Ω–æ-—Å–ª–∏–≤–æ—á–Ω–æ–π –Ω–∞—á–∏–Ω–∫–æ–π –≤–µ—Å.", unit:"–∫–≥", price:516 },
    { id:"w10", name:"–ú–∞–Ω—Ç—ã –ø–æ-—Å–∏–±–∏—Ä—Å–∫–∏ –≤–µ—Å.", unit:"–∫–≥", price:411 },
    { id:"w11", name:"–ù–∞–≥–≥–µ—Ç—Å—ã –§–∏—Ä–º–µ–Ω–Ω—ã–µ –≤–µ—Å.", unit:"–∫–≥", price:510 },
    { id:"w12", name:"–ü–µ–ª—å–º–µ–Ω–∏ –î–æ–º–∞—à–Ω–∏–µ –≤–µ—Å.", unit:"–∫–≥", price:398 },
    { id:"w13", name:"–ü–µ–ª—å–º–µ–Ω–∏ –ö—É—Ä–∏–Ω—ã–µ –≤–µ—Å.", unit:"–∫–≥", price:353 },
    { id:"w14", name:"–ü–µ–ª—å–º–µ–Ω–∏ –°–≤–∏–Ω–∏–Ω–∞-–ö—É—Ä–∏—Ü–∞ –≤–µ—Å.", unit:"–∫–≥", price:356 },
    { id:"w15", name:"–ü–µ–ª—å–º–µ–Ω–∏ –∏–∑ —Å–≤–∏–Ω–∏–Ω—ã –≤–µ—Å.", unit:"–∫–≥", price:358 },
    { id:"w16", name:"–ü–µ–ª—å–º–µ–Ω–∏ –∏–∑ —Ñ–∏–ª–µ –≥—Ä—É–¥–∫–∏ –∏–Ω–¥–µ–π–∫–∏ —Å–æ —Å–ª–∏–≤. –º–∞—Å–ª–æ–º –≤–µ—Å.", unit:"–∫–≥", price:411 },
    { id:"w17", name:"–ü–æ–¥–∫–æ–≥–æ–ª–∏ –î–æ–º–∞—à–Ω–∏–µ –≤–µ—Å.", unit:"–∫–≥", price:389 },
    { id:"w18", name:"–†–∞–≤–∏–æ–ª–∏ –≤–µ—Å.", unit:"–∫–≥", price:583 },
    { id:"w19", name:"–§—Ä–∏–∫–∞–¥–µ–ª—å–∫–∏ –õ—é–±–∏–º—ã–µ –≤–µ—Å.", unit:"–∫–≥", price:398 },
    { id:"w20", name:"–ß–µ–±—É—Ä–µ–∫–∏ –ø–æ-–¥–æ–º–∞—à–Ω–µ–º—É –≤–µ—Å.", unit:"–∫–≥", price:458 },
    { id:"w21", name:"–ß–µ–±—É—Ä–µ–∫–∏ —Å –∫—É—Ä–∏—Ü–µ–π –≤–µ—Å.", unit:"–∫–≥", price:380 },
    { id:"w22", name:"–ß–µ–±—É—Ä–µ–∫–∏ —Å —Å—ã—Ä–æ–º –≤–µ—Å.", unit:"–∫–≥", price:558 },
    { id:"w23", name:"–°—ã—Ä–Ω–∏–∫–∏ –≤–µ—Å.", unit:"–∫–≥", price:540 }
  ];

  // ===== –£–¢–ò–õ–ò–¢–´ =====

  const byId = (id) => document.getElementById(id);

  function rub(n){
    const x = Math.round((Number(n) || 0) * 100) / 100;
    const s = x.toLocaleString("ru-RU", { maximumFractionDigits: 2 });
    // –µ—Å–ª–∏ —Ü–µ–ª–æ–µ ‚Äî –±–µ–∑ .00
    const clean = s.replace(/,00$/, "");
    return clean + " ‚ÇΩ";
  }

  function todayYMD(){
    const d = new Date();
    const y = d.getFullYear();
    const m = String(d.getMonth()+1).padStart(2,"0");
    const day = String(d.getDate()).padStart(2,"0");
    return `${y}-${m}-${day}`;
  }

  function ymdToDMY(ymd){
    if(!ymd || !/^\d{4}-\d{2}-\d{2}$/.test(ymd)) return "";
    const [y,m,d] = ymd.split("-");
    return `${d}.${m}.${y}`;
  }

  function encodeTelegramText(text){
    return encodeURIComponent(text);
  }

  // ===== –°–û–°–¢–û–Ø–ù–ò–ï =====

  let items = []; // { id, productId, qty }

  // ===== –†–ï–ù–î–ï–† =====

  function renderManagers(){
    const sel = byId("manager");
    sel.innerHTML = "";
    managers.forEach(m => {
      const opt = document.createElement("option");
      opt.value = m.id;
      opt.textContent = m.name;
      sel.appendChild(opt);
    });
  }

  function renderClients(){
    const managerId = byId("manager").value;
    const m = managers.find(x => x.id === managerId) || managers[0];
    const sel = byId("client");
    sel.innerHTML = "";
    m.clients.forEach(c => {
      const opt = document.createElement("option");
      opt.value = c;
      opt.textContent = c;
      sel.appendChild(opt);
    });
  }

  function productOptionsHTML(selectedId){
    const sorted = [...products].sort((a,b) => a.name.localeCompare(b.name, "ru"));
    return sorted.map(p => {
      const sel = p.id === selectedId ? "selected" : "";
      const suffix = ` ‚Äî ${p.unit} / ${p.price}‚ÇΩ`;
      return `<option value="${p.id}" ${sel}>${escapeHtml(p.name)}${suffix}</option>`;
    }).join("");
  }

  function escapeHtml(s){
    return String(s)
      .replaceAll("&", "&amp;")
      .replaceAll("<", "&lt;")
      .replaceAll(">", "&gt;")
      .replaceAll('"', "&quot;")
      .replaceAll("'", "&#039;");
  }

  function getProduct(productId){
    return products.find(p => p.id === productId) || products[0];
  }

  function calcRowSum(productId, qty){
    const p = getProduct(productId);
    const q = Number(qty) || 0;
    return q * p.price;
  }

  function totalSum(){
    return items.reduce((acc, it) => acc + calcRowSum(it.productId, it.qty), 0);
  }

  function renderItems(){
    const wrap = byId("items");
    wrap.innerHTML = "";

    byId("itemsCount").textContent = `${items.length} –ø–æ–∑.`;

    items.forEach((it, idx) => {
      const p = getProduct(it.productId);
      const rowSum = calcRowSum(it.productId, it.qty);

      const step = p.unit === "–∫–≥" ? "0.1" : "1";
      const min = "0";

      const card = document.createElement("div");
      card.className = "bg-white rounded-2xl border border-slate-100 shadow-sm p-4";

      card.innerHTML = `
        <div class="flex items-start justify-between gap-3">
          <div class="w-full">
            <div class="text-xs font-semibold text-slate-500">–¢–û–í–ê–†</div>
            <select data-idx="${idx}" data-role="product"
              class="mt-1 w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-slate-900 focus:outline-none focus:ring-2 focus:ring-emerald-200">
              ${productOptionsHTML(it.productId)}
            </select>
          </div>

          <button data-idx="${idx}" data-role="remove"
            class="shrink-0 mt-5 rounded-xl border border-rose-200 bg-rose-50 px-3 py-2 text-rose-700 font-semibold hover:bg-rose-100 active:bg-rose-200 transition"
            title="–£–¥–∞–ª–∏—Ç—å">
            ‚úï
          </button>
        </div>

        <div class="mt-3 grid grid-cols-1 sm:grid-cols-3 gap-3">
          <div>
            <div class="text-xs font-semibold text-slate-500">–ï–î / –¶–ï–ù–ê</div>
            <div class="mt-1 rounded-xl border border-slate-100 bg-slate-50 px-3 py-2 text-slate-800 font-semibold">
              ${p.unit} / ${p.price}‚ÇΩ
            </div>
          </div>

          <div>
            <div class="text-xs font-semibold text-slate-500">–ö–û–õ–ò–ß–ï–°–¢–í–û</div>
            <input data-idx="${idx}" data-role="qty" type="number" inputmode="decimal"
              min="${min}" step="${step}" value="${String(it.qty).replace('"','')}"
              class="mt-1 w-full rounded-xl border border-slate-200 bg-white px-3 py-2 text-slate-900 focus:outline-none focus:ring-2 focus:ring-emerald-200"
            />
            <div class="text-[11px] text-slate-500 mt-1">
              ${p.unit === "–∫–≥" ? "–ú–æ–∂–Ω–æ –¥—Ä–æ–±–Ω–æ–µ (–∫–≥)" : "–¢–æ–ª—å–∫–æ —Ü–µ–ª–æ–µ (—à—Ç)"}
            </div>
          </div>

          <div>
            <div class="text-xs font-semibold text-slate-500">–°–£–ú–ú–ê</div>
            <div class="mt-1 rounded-xl border border-emerald-100 bg-emerald-50 px-3 py-2 text-emerald-800 font-bold">
              ${rub(rowSum)}
            </div>
          </div>
        </div>
      `;

      wrap.appendChild(card);
    });

    byId("total").textContent = rub(totalSum());
  }

  // ===== –¢–ï–ö–°–¢ –ó–ê–Ø–í–ö–ò =====

  function buildOrderText(){
    const mId = byId("manager").value;
    const m = managers.find(x => x.id === mId) || managers[0];
    const c = byId("client").value || "";
    const d = byId("date").value || "";
    const dText = d ? ymdToDMY(d) : "";

    const lines = [];
    lines.push("üßæ –ó–∞—è–≤–∫–∞ –§–µ—Ä–ú–∞–º–∞");
    lines.push("");
    lines.push(`üë§ –ú–µ–Ω–µ–¥–∂–µ—Ä: ${m.name}`);
    lines.push(`üè™ –ö–ª–∏–µ–Ω—Ç: ${c}`);
    if (dText) lines.push(`üìÖ –î–∞—Ç–∞ –ø—Ä–∏—ë–º–∞: ${dText}`);
    lines.push("");
    lines.push("üì¶ –ü–æ–∑–∏—Ü–∏–∏:");

    if(items.length === 0){
      lines.push("‚Äî (–Ω–µ—Ç –ø–æ–∑–∏—Ü–∏–π)");
    } else {
      items.forEach((it, i) => {
        const p = getProduct(it.productId);
        const q = Number(it.qty) || 0;
        const row = calcRowSum(it.productId, it.qty);
        const qText = p.unit === "–∫–≥"
          ? q.toLocaleString("ru-RU", { maximumFractionDigits: 2 })
          : String(Math.trunc(q));
        lines.push(`${i+1}) ${p.name}`);
        lines.push(`   ‚Ä¢ ${qText} ${p.unit} √ó ${p.price} ‚ÇΩ = ${rub(row)}`);
      });
    }

    lines.push("");
    lines.push(`üí∞ –ò–¢–û–ì–û: ${rub(totalSum())}`);

    return lines.join("\n");
  }

  // ===== –°–û–ë–´–¢–ò–Ø =====

  function addItem(){
    const defaultProduct = products[0];
    items.push({
      id: cryptoRandomId(),
      productId: defaultProduct.id,
      qty: defaultProduct.unit === "–∫–≥" ? 0.0 : 0
    });
    renderItems();
  }

  function removeItem(idx){
    items.splice(idx, 1);
    renderItems();
  }

  function setProduct(idx, productId){
    items[idx].productId = productId;
    const p = getProduct(productId);
    // –µ—Å–ª–∏ –ø–µ—Ä–µ—à–ª–∏ –Ω–∞ —à—Ç ‚Äî –æ–∫—Ä—É–≥–ª–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–Ω–∏–∑ –¥–æ —Ü–µ–ª–æ–≥–æ
    if(p.unit === "—à—Ç"){
      items[idx].qty = Math.trunc(Number(items[idx].qty) || 0);
    }
    renderItems();
  }

  function setQty(idx, qty){
    const p = getProduct(items[idx].productId);
    let q = Number(qty);
    if(!isFinite(q) || q < 0) q = 0;

    if(p.unit === "—à—Ç"){
      q = Math.trunc(q);
    } else {
      // –∫–≥ ‚Äî –æ—Å—Ç–∞–≤–ª—è–µ–º –¥—Ä–æ–±–Ω–æ–µ, –Ω–æ –æ–≥—Ä–∞–Ω–∏—á–∏–º –¥–æ 2 –∑–Ω–∞–∫–æ–≤
      q = Math.round(q * 100) / 100;
    }
    items[idx].qty = q;
    renderItems();
  }

  function cryptoRandomId(){
    try {
      return crypto.getRandomValues(new Uint32Array(1))[0].toString(16);
    } catch(e){
      return String(Date.now()) + "_" + Math.random().toString(16).slice(2);
    }
  }

  function onItemsClick(e){
    const t = e.target;
    if(!t || !t.dataset) return;

    const role = t.dataset.role;
    const idx = Number(t.dataset.idx);

    if(role === "remove"){
      removeItem(idx);
    }
  }

  function onItemsChange(e){
    const t = e.target;
    if(!t || !t.dataset) return;

    const role = t.dataset.role;
    const idx = Number(t.dataset.idx);

    if(role === "product"){
      setProduct(idx, t.value);
    } else if(role === "qty"){
      setQty(idx, t.value);
    }
  }

  async function copyText(){
    const text = buildOrderText();
    try{
      await navigator.clipboard.writeText(text);
      alert("‚úÖ –¢–µ–∫—Å—Ç –∑–∞—è–≤–∫–∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω");
    } catch(e){
      // fallback
      const ta = document.createElement("textarea");
      ta.value = text;
      document.body.appendChild(ta);
      ta.select();
      document.execCommand("copy");
      document.body.removeChild(ta);
      alert("‚úÖ –¢–µ–∫—Å—Ç –∑–∞—è–≤–∫–∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω");
    }
  }

  function openTelegram(){
    const text = buildOrderText();
    const shareUrl = "https://t.me/share/url?url=" + encodeURIComponent("") + "&text=" + encodeTelegramText(text);
    window.open(shareUrl, "_blank", "noopener,noreferrer");
  }

  // ===== INIT =====

  function init(){
    renderManagers();
    renderClients();

    const dateEl = byId("date");
    dateEl.value = todayYMD();

    byId("manager").addEventListener("change", () => {
      renderClients();
    });

    byId("addItemBtn").addEventListener("click", () => addItem());

    byId("items").addEventListener("click", onItemsClick);
    byId("items").addEventListener("change", onItemsChange);
    byId("items").addEventListener("input", (e) => {
      const t = e.target;
      if(t && t.dataset && t.dataset.role === "qty"){
        const idx = Number(t.dataset.idx);
        setQty(idx, t.value);
      }
    });

    byId("copyBtn").addEventListener("click", copyText);
    byId("telegramBtn").addEventListener("click", openTelegram);

    // —Å—Ç–∞—Ä—Ç–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞
    addItem();
  }

  init();
})();
</script>
</body>
</html>
